#!/bin/bash

# åŸºä¼°å®æ•°æ®å¤‡ä»½è„šæœ¬
# ç”¨äºŽå¯¼å‡ºæµè§ˆå™¨ localStorage ä¸­çš„æ•°æ®åˆ°æœ¬åœ°æ–‡ä»¶

set -e

BACKUP_DIR="${HOME}/.real-time-fund-backups"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
BACKUP_FILE="${BACKUP_DIR}/backup_${TIMESTAMP}.json"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "${BACKUP_DIR}"

echo "ðŸ“¦ åŸºä¼°å®æ•°æ®å¤‡ä»½å·¥å…·"
echo "====================="
echo ""
echo "âš ï¸  æ³¨æ„ï¼šæ­¤åº”ç”¨çš„æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨çš„ localStorage ä¸­"
echo "âš ï¸  è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰‹åŠ¨å¯¼å‡ºæ•°æ®ï¼š"
echo ""
echo "ðŸ“‹ å¯¼å‡ºæ­¥éª¤ï¼š"
echo "1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ï¼šhttp://localhost:3000"
echo "2. ç‚¹å‡»å³ä¸Šè§’è®¾ç½®å›¾æ ‡ï¼ˆâš™ï¸ï¼‰"
echo "3. åœ¨è®¾ç½®é¡µé¢ä¸­ç‚¹å‡»ã€Œå¯¼å‡ºé…ç½®ã€æŒ‰é’®"
echo "4. ä¸‹è½½çš„æ–‡ä»¶ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æ‚¨çš„ä¸‹è½½æ–‡ä»¶å¤¹"
echo "5. å°†ä¸‹è½½çš„æ–‡ä»¶ç§»åŠ¨åˆ°å¤‡ä»½ç›®å½•ï¼š"
echo "   mv ~/Downloads/æœ¬åœ°é…ç½®_*.json \"${BACKUP_FILE}\""
echo ""
echo "ðŸ“ å¤‡ä»½ç›®å½•ï¼š${BACKUP_DIR}"
echo ""
echo "ðŸ“‹ æ¢å¤æ­¥éª¤ï¼š"
echo "1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åº”ç”¨ï¼šhttp://localhost:3000"
echo "2. ç‚¹å‡»å³ä¸Šè§’è®¾ç½®å›¾æ ‡ï¼ˆâš™ï¸ï¼‰"
echo "3. åœ¨è®¾ç½®é¡µé¢ä¸­ç‚¹å‡»ã€Œé€‰æ‹©æ–‡ä»¶ã€"
echo "4. é€‰æ‹©ä¹‹å‰å¯¼å‡ºçš„ JSON æ–‡ä»¶"
echo "5. ç‚¹å‡»ã€Œå¯¼å…¥ã€æŒ‰é’®"
echo ""
echo "ðŸ’¡ æç¤ºï¼šå»ºè®®å®šæœŸå¤‡ä»½æ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ä¹‹å‰"
echo ""

# åˆ—å‡ºçŽ°æœ‰å¤‡ä»½
if [ -d "${BACKUP_DIR}" ] && [ -n "$(ls -A ${BACKUP_DIR} 2>/dev/null)" ]; then
  echo "ðŸ“š çŽ°æœ‰å¤‡ä»½æ–‡ä»¶ï¼š"
  ls -lh "${BACKUP_DIR}"/*.json 2>/dev/null | awk '{print "  " $9 " (" $5 ")"}'
else
  echo "ðŸ“­ æš‚æ— å¤‡ä»½æ–‡ä»¶"
fi
