# 数据持久化指南

## 📊 数据存储说明

### 数据存储位置

基估宝是一个**纯前端应用**，所有数据都存储在**浏览器的 localStorage** 中：

- ✅ 基金列表
- ✅ 持仓数据
- ✅ 自选标记
- ✅ 分组设置
- ✅ 刷新频率配置
- ✅ 待处理交易

### 重要特性

| 操作 | 数据是否丢失 | 说明 |
|------|-------------|------|
| 🔄 重启容器 | ❌ 不丢失 | 数据在浏览器中 |
| 🗑️ 删除容器 | ❌ 不丢失 | 数据在浏览器中 |
| 💻 重装应用 | ❌ 不丢失 | 数据在浏览器中 |
| 🧹 清除浏览器缓存 | ✅ **会丢失** | localStorage 被清空 |
| 🌐 更换浏览器 | ✅ **会丢失** | 数据在原浏览器中 |
| 📱 更换设备 | ✅ **会丢失** | 除非使用云同步 |

---

## 🚀 Docker 持久化运行

### 使用 Docker Compose（推荐）

```bash
# 启动服务（自动重启）
docker compose up -d

# 查看日志
docker compose logs -f

# 停止服务
docker compose down

# 重启服务
docker compose restart
```

**特点**：
- ✅ 容器崩溃后自动重启
- ✅ 系统重启后自动启动
- ✅ 健康检查监控

### 使用 Docker 命令

```bash
# 运行容器
docker run -d \
  --name real-time-fund \
  --restart unless-stopped \
  -p 3000:3000 \
  real-time-fund

# 查看状态
docker ps | grep real-time-fund

# 查看日志
docker logs -f real-time-fund
```

---

## 💾 数据备份与恢复

### 方法1：应用内导出/导入（推荐）

**导出数据**：
1. 打开应用：http://localhost:3000
2. 点击右上角 ⚙️ 设置图标
3. 点击"导出配置"按钮
4. 文件自动下载：`本地配置_YYYYMMDD_HHMMSS.json`

**导入数据**：
1. 打开应用：http://localhost:3000
2. 点击右上角 ⚙️ 设置图标
3. 点击"选择文件"，选择导出的 JSON 文件
4. 点击"导入"按钮

### 方法2：使用云同步功能

应用支持 Supabase 云同步，可以跨设备同步数据：

1. 点击右上角用户图标 👤
2. 输入邮箱地址
3. 检查邮箱中的验证码
4. 输入验证码完成登录
5. 数据自动同步到云端

**优点**：
- ✅ 跨设备访问
- ✅ 自动备份
- ✅ 实时同步

### 方法3：浏览器开发者工具备份

```bash
# 在浏览器控制台执行
# 1. 导出所有 localStorage 数据
copy(JSON.stringify(localStorage))

# 2. 恢复数据（将导出的 JSON 粘贴到 data 变量）
const data = {...}; // 粘贴导出的数据
Object.keys(data).forEach(key => localStorage.setItem(key, data[key]));
```

---

## 🔧 自动备份脚本

使用项目提供的备份脚本：

```bash
# 运行备份提示脚本
bash scripts/backup-data.sh
```

---

## 🧪 测试备份功能

项目提供了测试工具来验证备份功能：

### 1. 备份文件验证工具

验证导出的 JSON 文件格式是否正确：

```bash
# 验证备份文件
node scripts/validate-backup.js ~/Downloads/realtime-fund-config-*.json
```

**验证内容**：
- JSON 格式是否正确
- 必需字段是否完整
- 数据类型是否正确
- 基金数据结构是否有效

**示例输出**：
```
✅ JSON 格式正确
✓ funds: 数组 (1 项)
✓ favorites: 数组 (2 项)
✓ groups: 数组 (1 项)
✓ refreshMs: 数字 (30000ms)
...
✅ 文件验证通过！备份文件格式正确。
```

### 2. 完整功能测试

运行完整的备份功能测试流程：

```bash
bash scripts/test-backup.sh
```

**测试内容**：
1. 导出功能测试
2. 导入功能测试
3. 文件格式验证
4. 边界情况测试

### 3. 示例备份文件

项目包含一个示例备份文件用于参考：

```bash
cat scripts/backup-example.json
```

---

## 📋 备份检查清单

在以下情况**务必备份**数据：

- [ ] 清除浏览器缓存之前
- [ ] 更换浏览器之前
- [ ] 重装操作系统之前
- [ ] 更换设备之前
- [ ] 定期备份（建议每月一次）

---

## 🆨 数据丢失恢复

如果不小心丢失了数据：

1. **如果有云同步**：重新登录即可恢复
2. **如果有导出文件**：使用导入功能恢复
3. **都没有**：需要重新添加基金

---

## 💡 最佳实践

1. **启用云同步**：最推荐的备份方式
2. **定期导出**：每月导出一次配置文件
3. **多处备份**：云同步 + 本地导出双重保险
4. **记录基金代码**：将常用基金代码记录在文本文件中

---

## ❓ 常见问题

### Q: 重启 Docker 容器会丢失数据吗？
A: **不会**。数据存储在浏览器中，与服务器无关。

### Q: 如何在多台电脑上同步数据？
A: 使用 Supabase 云同步功能，登录同一账号即可。

### Q: 应用会收集我的数据吗？
A: **不会**。所有数据存储在本地浏览器中，只有启用云同步时才会加密存储到 Supabase。

### Q: 导出的文件包含敏感信息吗？
A: 包含您的基金配置，但**不包含** Supabase 登录凭证。请妥善保管导出文件。

---

## 📞 技术支持

如有问题，请通过应用的"提交反馈"功能联系我们。
